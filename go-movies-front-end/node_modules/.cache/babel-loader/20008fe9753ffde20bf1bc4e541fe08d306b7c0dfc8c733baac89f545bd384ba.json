{"ast":null,"code":"import{useCallback,useEffect,useState}from\"react\";import{Link,Outlet,useNavigate}from\"react-router-dom\";import Alert from\"./components/Alert\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function App(){const[jwtToken,setJwtToken]=useState(\"\");const[alertMessage,setAlertMessage]=useState(\"\");const[alertClassName,setAlertClassName]=useState(\"d-none\");const[tickInterval,setTickInterval]=useState();const navigate=useNavigate();const logOut=()=>{const requestOptions={method:\"GET\",credentials:\"include\"};fetch(\"\".concat(process.env.REACT_APP_BACKEND,\"/logout\"),requestOptions).catch(error=>{console.log(\"error logging out \",error);}).finally(()=>{setJwtToken(\"\");toggleRefresh(false);});navigate(\"/login\");};const toggleRefresh=useCallback(status=>{console.log(\"clicked\");if(status){console.log(\"tuning on ticking\");let i=setInterval(()=>{const requestOptions={method:\"GET\",credentials:\"include\"};fetch(\"\".concat(process.env.REACT_APP_BACKEND,\"/refresh\"),requestOptions).then(response=>response.json()).then(data=>{if(data.access_token){setJwtToken(data.access_token);}}).catch(error=>{console.log(\"user is not logged in\");});},60000);setTickInterval(i);console.log(\"Setting the tick interval to \",i);}else{console.log(\"turning off the ticking\");console.log(\"turning off tick interval\",tickInterval);setTickInterval(null);clearInterval(tickInterval);}},[tickInterval]);useEffect(()=>{if(jwtToken===\"\"){const requestOptions={method:\"GET\",credentials:\"include\"};fetch(\"\".concat(process.env.REACT_APP_BACKEND,\"/refresh\"),requestOptions).then(response=>response.json()).then(data=>{if(data.access_token){setJwtToken(data.access_token);toggleRefresh(true);}}).catch(error=>{console.log(\"user is not logged in\",error);});}},[jwtToken,toggleRefresh]);return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"mt-3\",children:\" Go watch a movie\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col text-end\",children:jwtToken===\"\"?/*#__PURE__*/_jsx(Link,{to:\"/login\",children:/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-success\",children:\"Log in\"})}):/*#__PURE__*/_jsx(\"a\",{href:\"#!\",onClick:logOut,children:/*#__PURE__*/_jsx(\"span\",{className:\"badge bg-danger\",children:\"Logout\"})})}),/*#__PURE__*/_jsx(\"hr\",{className:\"mb-3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col md-2\",children:/*#__PURE__*/_jsx(\"nav\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"list-group\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"list-group-item list-group-item-action\",children:\"Home\"}),/*#__PURE__*/_jsx(Link,{to:\"/movies\",className:\"list-group-item list-group-item-action\",children:\"Movies\"}),/*#__PURE__*/_jsx(Link,{to:\"/genres\",className:\"list-group-item list-group-item-action\",children:\"Genres\"}),jwtToken!==\"\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:\"/admin/movie/0\",className:\"list-group-item list-group-item-action\",children:\"Add a movie\"}),/*#__PURE__*/_jsx(Link,{to:\"/manage-catalogue\",className:\"list-group-item list-group-item-action\",children:\"Manage the catalogue\"}),/*#__PURE__*/_jsx(Link,{to:\"/graphql\",className:\"list-group-item list-group-item-action\",children:\"GraphQl\"})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col md-10\",children:[/*#__PURE__*/_jsx(Alert,{message:alertMessage,className:alertClassName}),/*#__PURE__*/_jsx(Outlet,{context:{jwtToken,setJwtToken,setAlertClassName,setAlertMessage,toggleRefresh}})]})]})]});}export default App;","map":{"version":3,"names":["useCallback","useEffect","useState","Link","Outlet","useNavigate","Alert","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","App","jwtToken","setJwtToken","alertMessage","setAlertMessage","alertClassName","setAlertClassName","tickInterval","setTickInterval","navigate","logOut","requestOptions","method","credentials","fetch","concat","process","env","REACT_APP_BACKEND","catch","error","console","log","finally","toggleRefresh","status","i","setInterval","then","response","json","data","access_token","clearInterval","className","children","to","href","onClick","message","context"],"sources":["D:/Go/React-With-Go/go-movies-front-end/src/App.js"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { Link, Outlet, useNavigate } from \"react-router-dom\";\nimport Alert from \"./components/Alert\";\n\nfunction App() {\n  const [jwtToken, setJwtToken] = useState(\"\");\n  const [alertMessage, setAlertMessage] = useState(\"\");\n  const [alertClassName, setAlertClassName] = useState(\"d-none\");\n\n  const [tickInterval, setTickInterval] = useState();\n\n  const navigate = useNavigate();\n\n  const logOut = () => {\n    const requestOptions = {\n      method: \"GET\",\n      credentials: \"include\",\n    };\n\n    fetch(`${process.env.REACT_APP_BACKEND}/logout`, requestOptions)\n      .catch((error) => {\n        console.log(\"error logging out \", error);\n      })\n      .finally(() => {\n        setJwtToken(\"\");\n        toggleRefresh(false);\n      });\n\n    navigate(\"/login\");\n  };\n\n  const toggleRefresh = useCallback(\n    (status) => {\n      console.log(\"clicked\");\n\n      if (status) {\n        console.log(\"tuning on ticking\");\n        let i = setInterval(() => {\n          const requestOptions = {\n            method: \"GET\",\n            credentials: \"include\",\n          };\n\n          fetch(`${process.env.REACT_APP_BACKEND}/refresh`, requestOptions)\n            .then((response) => response.json())\n            .then((data) => {\n              if (data.access_token) {\n                setJwtToken(data.access_token);\n              }\n            })\n            .catch((error) => {\n              console.log(\"user is not logged in\");\n            });\n        }, 60000);\n        setTickInterval(i);\n        console.log(\"Setting the tick interval to \", i);\n      } else {\n        console.log(\"turning off the ticking\");\n        console.log(\"turning off tick interval\", tickInterval);\n        setTickInterval(null);\n        clearInterval(tickInterval);\n      }\n    },\n    [tickInterval]\n  );\n\n  useEffect(() => {\n    if (jwtToken === \"\") {\n      const requestOptions = {\n        method: \"GET\",\n        credentials: \"include\",\n      };\n\n      fetch(`${process.env.REACT_APP_BACKEND}/refresh`, requestOptions)\n        .then((response) => response.json())\n        .then((data) => {\n          if (data.access_token) {\n            setJwtToken(data.access_token);\n            toggleRefresh(true);\n          }\n        })\n        .catch((error) => {\n          console.log(\"user is not logged in\", error);\n        });\n    }\n  }, [jwtToken, toggleRefresh]);\n\n  return (\n    <div className=\"container\">\n      <div className=\"row\">\n        <div className=\"col\">\n          <h1 className=\"mt-3\"> Go watch a movie</h1>\n        </div>\n        <div className=\"col text-end\">\n          {jwtToken === \"\" ? (\n            <Link to=\"/login\">\n              <span className=\"badge bg-success\">Log in</span>\n            </Link>\n          ) : (\n            <a href=\"#!\" onClick={logOut}>\n              <span className=\"badge bg-danger\">Logout</span>\n            </a>\n          )}\n        </div>\n        <hr className=\"mb-3\"></hr>\n      </div>\n      <div className=\"row\">\n        <div className=\"col md-2\">\n          <nav>\n            <div className=\"list-group\">\n              <Link to=\"/\" className=\"list-group-item list-group-item-action\">\n                Home\n              </Link>\n              <Link\n                to=\"/movies\"\n                className=\"list-group-item list-group-item-action\"\n              >\n                Movies\n              </Link>\n              <Link\n                to=\"/genres\"\n                className=\"list-group-item list-group-item-action\"\n              >\n                Genres\n              </Link>\n              {jwtToken !== \"\" && (\n                <>\n                  <Link\n                    to=\"/admin/movie/0\"\n                    className=\"list-group-item list-group-item-action\"\n                  >\n                    Add a movie\n                  </Link>\n                  <Link\n                    to=\"/manage-catalogue\"\n                    className=\"list-group-item list-group-item-action\"\n                  >\n                    Manage the catalogue\n                  </Link>\n                  <Link\n                    to=\"/graphql\"\n                    className=\"list-group-item list-group-item-action\"\n                  >\n                    GraphQl\n                  </Link>\n                </>\n              )}\n            </div>\n          </nav>\n        </div>\n\n        <div className=\"col md-10\">\n          <Alert message={alertMessage} className={alertClassName} />\n          <Outlet\n            context={{\n              jwtToken,\n              setJwtToken,\n              setAlertClassName,\n              setAlertMessage,\n              toggleRefresh,\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}